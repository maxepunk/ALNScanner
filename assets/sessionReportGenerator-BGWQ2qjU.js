import{S as l}from"./main-D1p0yGME.js";class T{constructor(n){this.tokenDatabase=n||{}}generate({session:n,scores:r,transactions:t,playerScans:s}){const i=this._formatDuration(n.startTime,n.endTime),o=this._formatDate(n.startTime),c=(n.teams||[]).length;return[`# Session Report: ${n.name}`,`**${o} | Duration: ${i} | Teams: ${c}**`,"",this._buildSessionSummary(n,r,t,s),this._buildDetectiveSection(t),this._buildBlackMarketSection(t),this._buildPlayerActivitySection(s,t)].join(`
`)}_buildSessionSummary(n,r,t,s){const i=t.filter(a=>a.status==="accepted"),o=i.filter(a=>a.mode==="detective"),c=i.filter(a=>a.mode==="blackmarket"),d=new Set(i.map(a=>a.tokenId)),h=[...r].sort((a,e)=>e.score-a.score).map((a,e)=>`${e+1}. **${a.teamId}** — ${this._formatCurrency(a.score)}`).join(`
`);return["## Session Summary","",`- **Teams:** ${(n.teams||[]).join(", ")}`,`- **Total Transactions:** ${i.length} (${o.length} detective, ${c.length} black market)`,`- **Player Scans:** ${s.length}`,`- **Unique Tokens Processed:** ${d.size}`,"","### Final Standings","",h,"","---",""].join(`
`)}_buildDetectiveSection(n){const r=n.filter(s=>s.status==="accepted"&&s.mode==="detective").sort((s,i)=>s.tokenId.localeCompare(i.tokenId)),t=["## Detective Evidence Log",""];if(r.length===0)return t.push("*No detective transactions this session.*"),t.push(""),t.push("---"),t.push(""),t.join(`
`);t.push("| Token | Owner | Exposed By | Time | Evidence |"),t.push("|-------|-------|------------|------|----------|");for(const s of r){const i=this._getTokenOwner(s.tokenId),o=this._formatTimestamp(s.timestamp),c=(s.summary||"—").replace(/\|/g,"\\|").replace(/\n/g," ");t.push(`| ${s.tokenId} | ${i} | ${s.teamId} | ${o} | ${c} |`)}return t.push(""),t.push("---"),t.push(""),t.join(`
`)}_buildBlackMarketSection(n){const r=n.filter(o=>o.status==="accepted"&&o.mode==="blackmarket").sort((o,c)=>new Date(o.timestamp)-new Date(c.timestamp)),t=["## Black Market Transactions",""];if(r.length===0)return t.push("*No black market transactions this session.*"),t.push(""),t.push("---"),t.push(""),t.join(`
`);t.push("| Token | Owner | Buried By | Points | Rating | Type | Breakdown |"),t.push("|-------|-------|-----------|--------|--------|------|-----------|");for(const o of r){const c=this._getTokenOwner(o.tokenId),d=o.valueRating||0,m=o.memoryType||"UNKNOWN",h=l.BASE_VALUES[d]||0,p=l.TYPE_MULTIPLIERS[m]??l.TYPE_MULTIPLIERS.UNKNOWN??0,a=`${this._formatCurrency(h)} × ${p}x`;t.push(`| ${o.tokenId} | ${c} | ${o.teamId} | ${this._formatCurrency(o.points)} | ${d}★ | ${m} | ${a} |`)}const s={};for(const o of r)s[o.teamId]=(s[o.teamId]||0)+o.points;t.push(""),t.push("### Team Subtotals"),t.push("");const i=Object.entries(s).sort((o,c)=>c[1]-o[1]);for(const[o,c]of i)t.push(`- **${o}:** ${this._formatCurrency(c)}`);return t.push(""),t.push("---"),t.push(""),t.join(`
`)}_buildPlayerActivitySection(n,r){const t=["## Player Activity",""];if(n.length===0)return t.push("*No player scans this session.*"),t.push(""),t.join(`
`);const s=[...n].sort((e,u)=>new Date(e.timestamp)-new Date(u.timestamp));t.push("| Token | Owner | Device | Time |"),t.push("|-------|-------|--------|------|");for(const e of s){const u=this._getTokenOwner(e.tokenId),k=this._formatTimestamp(e.timestamp);t.push(`| ${e.tokenId} | ${u} | ${e.deviceId} | ${k} |`)}t.push(""),t.push("### Activity Stats"),t.push("");const i={};for(const e of n)i[e.deviceId]=(i[e.deviceId]||0)+1;const o=Object.entries(i).sort((e,u)=>u[1]-e[1]);t.push("**Most Active Devices:**");for(const[e,u]of o)t.push(`- ${e}: ${u} scan${u!==1?"s":""}`);t.push("");const c={};for(const e of n)c[e.tokenId]=(c[e.tokenId]||0)+1;const m=Object.entries(c).sort((e,u)=>u[1]-e[1]).filter(([,e])=>e>1);if(m.length>0){t.push("**Most Scanned Tokens:**");for(const[e,u]of m){const k=this._getTokenOwner(e);t.push(`- ${e} (${k}): ${u} scans`)}t.push("")}const h=new Set(r.filter(e=>e.status==="accepted").map(e=>e.tokenId)),a=[...new Set(n.map(e=>e.tokenId))].filter(e=>!h.has(e));if(a.length>0){t.push("**Tokens Scanned but Never Turned In:**");for(const e of a.sort()){const u=this._getTokenOwner(e);t.push(`- ${e} (${u})`)}}return t.push(""),t.join(`
`)}_getTokenOwner(n){return this.tokenDatabase[n]?.owner||"Unknown"}_formatCurrency(n){return"$"+(n??0).toLocaleString("en-US")}_formatTimestamp(n){return n?new Date(n).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}):"—"}_formatDate(n){return n?new Date(n).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"Unknown Date"}_formatDuration(n,r){if(!n||!r)return"Unknown";const t=new Date(r)-new Date(n),s=Math.floor(t/6e4),i=Math.floor(s/60),o=s%60;return`${i}h ${o}m`}}export{T as SessionReportGenerator};
//# sourceMappingURL=sessionReportGenerator-BGWQ2qjU.js.map
